:root { color-scheme: dark; }
body { margin:0; background:#0b0f14; color:#e6edf3; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
.wrap { max-width: 1100px; margin: 0 auto; padding: 16px; display:flex; flex-direction:column; gap:14px; }
.card { border:1px solid #243244; border-radius: 18px; background: linear-gradient(180deg,#0f1724,#0b121c); box-shadow: 0 20px 50px rgba(0,0,0,.25); overflow:hidden; }
.cardHeader { display:flex; align-items:center; justify-content:space-between; padding: 14px 16px; border-bottom: 1px solid #1e2a3c; }
.title { font-size: 32px; font-weight: 900; letter-spacing: -0.5px; display:flex; align-items:center; gap:10px;}
.pill { border:1px solid #243244; border-radius: 999px; padding: 8px 12px; background:#0b121c; display:inline-flex; align-items:center; gap:10px; }
.pill input { width: 360px; max-width: 56vw; background: transparent; border: none; outline: none; color:#e6edf3; font: inherit; }
button { cursor:pointer; border:1px solid #243244; background:#111a27; color:#e6edf3; border-radius: 14px; padding: 10px 14px; font-weight: 800; }
button:disabled { opacity: .55; cursor:not-allowed; }
.content { padding: 18px 16px; }
h2 { margin: 0 0 10px 0; font-size: 34px; letter-spacing: -0.5px; }
p { margin: 0 0 10px 0; font-size: 20px; line-height: 1.25; color:#d7deea; }
.metaRow { display:flex; flex-wrap:wrap; gap:10px; margin-top:14px; }
.meta { display:inline-flex; align-items:center; gap:10px; border:1px solid #243244; border-radius: 999px; padding: 10px 12px; background:#0b121c; font-size: 16px; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.small { font-size: 14px; color:#aab6ca; }
.split { display:flex; align-items:flex-start; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.gameHeader { display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
.stats { display:flex; gap:10px; flex-wrap:wrap; }
.grid { display:flex; flex-wrap:wrap; gap:16px; padding: 18px 16px; min-height: 300px; }

.bottle {
  width: 84px; height: 220px;
  border-radius: 22px 22px 26px 26px;
  border: 2px solid rgba(220,232,255,.14);
  background: rgba(0,0,0,.25);
  position:relative;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,.03);
  display:flex; flex-direction:column-reverse;
  overflow:hidden;
  user-select:none;
  touch-action: manipulation;
  transform: translateZ(0);
}
.bottle::before {
  content:"";
  position:absolute; inset: 10px 10px 10px 10px;
  border-radius: 18px 18px 22px 22px;
  border:1px solid rgba(255,255,255,.06);
  pointer-events:none;
}
.bottle.selected { outline: 3px solid rgba(130, 210, 255,.45); box-shadow: 0 0 0 6px rgba(80,140,255,.12), inset 0 0 0 2px rgba(255,255,255,.04); }

.seg {
  width:100%;
  height: 22%;
  position: relative;
  overflow: hidden;
}

/* --------- SVG Pattern Overlay (Role-Based) ---------
   Verified repo path: ./assets/elements/textures/pattern_*.svg
*/
.seg::after{
  content:"";
  position:absolute;
  inset:0;
  pointer-events:none;
  opacity:.90;
  background-size:64px 64px;
  background-repeat:repeat;
  mix-blend-mode: screen;
}

/* Default role mappings */
.seg.role-volatile::after   { background-image: url("./elements/textures/pattern_ripples.svg"); animation: drift 7s linear infinite; }
.seg.role-catalyst::after   { background-image: url("./elements/textures/pattern_streaks.svg"); animation: drift 6s linear infinite; }
.seg.role-stabilizer::after { background-image: url("./elements/textures/pattern_noise.svg"); opacity:.52; }
.seg.role-structural::after,
.seg.role-foundational::after { background-image: url("./elements/textures/pattern_grid.svg"); opacity:.66; }
.seg.role-transmission::after,
.seg.role-conversion::after { background-image: url("./elements/textures/pattern_chevrons.svg"); opacity:.66; }

/* Element-specific overrides (optional, improves readability on similar colors) */
.seg.el-EM::after { background-image: url("./elements/textures/pattern_bubbles.svg"); opacity:.78; animation: drift 8s linear infinite; }
.seg.el-CO::after,
.seg.el-DI::after { background-image: url("./elements/textures/pattern_hatch.svg"); opacity:.66; }

@media (prefers-reduced-motion: reduce) {
  .seg::after{ animation:none !important; }
}
/* Desktop-only calming pass (optional, mobile-first default stays strong) */
@media (min-width: 900px) {
  .seg::after { opacity: .6; }
}
@keyframes drift {
  from { background-position: 0 0; }
  to   { background-position: 64px 64px; }
}

.controls { display:flex; gap:10px; padding: 0 16px 16px 16px; flex-wrap:wrap; align-items:center;}
.toast { position: fixed; left: 50%; bottom: 22px; transform: translateX(-50%); background:#0b121c; border:1px solid #243244; border-radius: 999px; padding: 10px 14px; font-weight:800; opacity:0; transition: opacity .18s ease; pointer-events:none;}
.toast.show { opacity:1; }
.pourFX {
  position: fixed; width: 10px; height: 10px; border-radius: 999px;
  pointer-events:none;
  opacity:0;
  transform: translate(-50%, -50%);
  filter: blur(.2px);
}
.dmStatus {
  margin-top: 2px;
  color:#aab6ca;
  font-size: 14px;
  line-height: 1.2;
}

/* ---------- Lab Legend (chemical meaning) ---------- */
.legend { display:flex; flex-wrap:wrap; gap:10px; padding: 10px 16px 0 16px; }
.legendItem{ display:flex; align-items:center; gap:10px; border:1px solid #243244; border-radius: 999px; padding: 8px 10px; background:#0b121c; }
.swatch{ width:14px; height:14px; border-radius: 999px; border:1px solid rgba(255,255,255,.14); }
.legendText{ display:flex; flex-direction:column; line-height:1.05; }
.legendTop{ font-weight:900; font-size:13px; }
.legendSub{ font-size:12px; color:#aab6ca; }
.thesisPill{ border:1px dashed #2a3a52; background: rgba(17,26,39,.55); }

/* ---------- Stabilizer Bottle (locked/hidden) ---------- */
.bottle.locked { opacity: .55; filter: saturate(.7); outline: 2px dashed rgba(200,220,255,.18); }
.bottle.locked::after{
  content:"ðŸ”’ STABILIZER";
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%, -50%);
  font-weight: 900;
  font-size: 12px;
  letter-spacing: .5px;
  color: rgba(230,237,243,.9);
  background: rgba(11,18,28,.85);
  border: 1px solid rgba(36,50,68,.9);
  padding: 6px 10px;
  border-radius: 999px;
}
.bottle.hiddenSegs .seg { background: transparent !important; }
